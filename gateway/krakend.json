{
  "$schema": "https://www.krakend.io/schema/v3.json",
  "version": 3,
  "name": "URL Shortener Gateway - Release 0.2.0",
  "port": 8080,
  "host": ["0.0.0.0"],
  "timeout": "30s",
  "cache_ttl": "300s",
  "output_encoding": "json",

  "endpoints": [
    {
      "endpoint": "/health",
      "method": "GET",
      "output_encoding": "no-op",
      "backend": [
        {
          "url_pattern": "/health",
          "encoding": "no-op",
          "method": "GET",
          "host": ["http://url-shortener-service:3002"]
        }
      ]
    },
    {
      "endpoint": "/auth/login",
      "method": "POST",
      "timeout": "10s",
      "backend": [
        {
          "url_pattern": "/auth/login",
          "method": "POST",
          "host": ["http://identity-service:3001"]
        }
      ],
      "extra_config": {
        "security/rate-limit": {
          "max_rate": 30,
          "capacity": 30,
          "period": "1m"
        }
      }
    },
    {
      "endpoint": "/auth/register",
      "method": "POST",
      "timeout": "10s",
      "backend": [
        {
          "url_pattern": "/auth/register",
          "method": "POST",
          "host": ["http://identity-service:3001"]
        }
      ],
      "extra_config": {
        "security/rate-limit": {
          "max_rate": 10,
          "capacity": 10,
          "period": "1m"
        }
      }
    },
    {
      "endpoint": "/auth/me",
      "method": "GET",
      "timeout": "5s",
      "backend": [
        {
          "url_pattern": "/auth/me",
          "method": "GET",
          "host": ["http://identity-service:3001"]
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "HS256",
          "key": "your-jwt-secret-key",
          "disable_jwk_security": true
        }
      }
    },
    {
      "endpoint": "/shorten",
      "method": "POST",
      "timeout": "10s",
      "backend": [
        {
          "url_pattern": "/shorten",
          "method": "POST",
          "host": ["http://url-shortener-service:3002"]
        }
      ],
      "extra_config": {
        "security/rate-limit": {
          "max_rate": 50,
          "capacity": 50,
          "period": "1m"
        },
        "validation/json-schema": {
          "type": "object",
          "properties": {
            "originalUrl": {
              "type": "string",
              "format": "uri",
              "minLength": 1,
              "maxLength": 2048
            }
          },
          "required": ["originalUrl"]
        }
      }
    },
    {
      "endpoint": "/info/{shortCode}",
      "method": "GET",
      "timeout": "5s",
      "backend": [
        {
          "url_pattern": "/info/{shortCode}",
          "method": "GET",
          "host": ["http://url-shortener-service:3002"]
        }
      ],
      "extra_config": {
        "security/rate-limit": {
          "max_rate": 100,
          "capacity": 100,
          "period": "1m"
        }
      }
    },
    {
      "endpoint": "/{shortCode}",
      "method": "GET",
      "timeout": "5s",
      "output_encoding": "no-op",
      "backend": [
        {
          "url_pattern": "/{shortCode}",
          "method": "GET",
          "encoding": "no-op",
          "host": ["http://url-shortener-service:3002"]
        }
      ],
      "extra_config": {
        "security/rate-limit": {
          "max_rate": 200,
          "capacity": 200,
          "period": "1m"
        }
      }
    },
    {
      "endpoint": "/docs",
      "method": "GET",
      "output_encoding": "no-op",
      "backend": [
        {
          "url_pattern": "/",
          "method": "GET",
          "encoding": "no-op",
          "host": ["http://docs-server:80"]
        }
      ]
    },
    {
      "endpoint": "/docs/identity",
      "method": "GET",
      "output_encoding": "no-op",
      "backend": [
        {
          "url_pattern": "/api-json",
          "method": "GET",
          "encoding": "no-op",
          "host": ["http://identity-service:3001"]
        }
      ]
    },
    {
      "endpoint": "/docs/url-shortener", 
      "method": "GET",
      "output_encoding": "no-op",
      "backend": [
        {
          "url_pattern": "/api-json",
          "method": "GET",
          "encoding": "no-op",
          "host": ["http://url-shortener-service:3002"]
        }
      ]
    }
  ],

  "extra_config": {
    "security/cors": {
      "allow_origins": ["*"],
      "allow_methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
      "allow_headers": ["Content-Type", "Authorization"],
      "expose_headers": ["Content-Length"],
      "max_age": "12h",
      "allow_credentials": false
    },
    "telemetry/logging": {
      "level": "INFO",
      "prefix": "[KRAKEND]",
      "syslog": false,
      "stdout": true
    },
    "telemetry/metrics": {
      "collection_time": "60s",
      "proxy_disabled": false,
      "router_disabled": false,
      "backend_disabled": false,
      "endpoint_disabled": false,
      "listen_address": ":8090"
    }
  }
} 